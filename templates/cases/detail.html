{% extends 'base.html' %}

{% block title %}{{ case.title }} - AI Case Interview Simulator{% endblock %}

{% block content %}
<div class="px-4 py-6 sm:px-0">
    <div class="max-w-4xl mx-auto">
        <div class="mb-6">
            <a href="{% url 'case_list' %}" class="text-indigo-600 hover:text-indigo-800">← Back to Cases</a>
        </div>
        
        <div class="bg-white shadow rounded-lg p-6">
            <h1 class="text-3xl font-bold text-gray-900 mb-4">{{ case.title }}</h1>
            <p class="text-sm text-gray-500 mb-6">{{ case.get_case_type_display }} • Created {{ case.created_at|date:"M d, Y" }}</p>
            
            <div class="prose max-w-none">
                <h2 class="text-xl font-semibold text-gray-900 mb-4">Case Prompt</h2>
                <p class="text-gray-700 mb-6 whitespace-pre-wrap">{{ case.prompt }}</p>
                
                {% if case.context %}
                <h2 class="text-xl font-semibold text-gray-900 mb-4">Context</h2>
                <div class="bg-gray-50 rounded-lg p-4 mb-6">
                    <div class="text-sm text-gray-700">
                        {% if case.context.client %}
                        <p class="mb-2"><strong>Client:</strong> {{ case.context.client }}</p>
                        {% endif %}
                        {% if case.context.situation %}
                        <p class="mb-2"><strong>Situation:</strong> {{ case.context.situation }}</p>
                        {% endif %}
                        {% if case.context.objective %}
                        <p class="mb-2"><strong>Objective:</strong> {{ case.context.objective }}</p>
                        {% endif %}
                    </div>
                </div>
                {% endif %}
                
                {% if case.exhibits %}
                <h2 class="text-xl font-semibold text-gray-900 mb-4">Exhibits</h2>
                {% for exhibit in case.exhibits %}
                <div class="bg-gray-50 rounded-lg p-4 mb-4">
                    <h3 class="text-lg font-medium text-gray-900 mb-3">{{ exhibit.title }}</h3>
                    
                    {% if exhibit.type == "table" and exhibit.data.columns %}
                    <div class="overflow-x-auto">
                        <table class="min-w-full border-collapse border border-gray-300">
                            <thead class="bg-gray-200">
                                <tr>
                                    {% for col in exhibit.data.columns %}
                                    <th class="border border-gray-300 px-4 py-2 text-left text-sm font-medium text-gray-900">{{ col }}</th>
                                    {% endfor %}
                                </tr>
                            </thead>
                            <tbody>
                                {% for row in exhibit.data.rows %}
                                <tr class="hover:bg-gray-100">
                                    {% for cell in row %}
                                    <td class="border border-gray-300 px-4 py-2 text-sm text-gray-700">{{ cell }}</td>
                                    {% endfor %}
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    
                    {% elif exhibit.type == "bar" %}
                    <div class="space-y-3">
                        {% load custom_filters %}
                        {% for label in exhibit.data.labels %}
                        {% with value=exhibit.data.values|get_item:forloop.counter0 max_val=exhibit.data.values|max_value %}
                        <div>
                            <div class="flex justify-between mb-1">
                                <span class="text-sm font-medium text-gray-700">{{ label }}</span>
                                <span class="text-sm text-gray-600">{{ value }}{{ exhibit.data.unit }}</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-6">
                                <div class="bg-indigo-600 h-6 rounded-full flex items-center justify-end pr-2" style="width: {% widthratio value max_val 100 %}%">
                                    <span class="text-xs font-semibold text-white">{{ value }}{{ exhibit.data.unit }}</span>
                                </div>
                            </div>
                        </div>
                        {% endwith %}
                        {% endfor %}
                    </div>
                    
                    {% elif exhibit.type == "pie" %}
                    <div class="grid grid-cols-2 gap-6">
                        <div class="flex items-center justify-center">
                            <svg viewBox="0 0 200 200" class="w-48 h-48">
                                {% load custom_filters %}
                                {% for label in exhibit.data.labels %}
                                {% with angle=forloop.counter0|pie_angle:exhibit.data.values %}
                                <path d="M 100 100 L {{ angle.x1 }} {{ angle.y1 }} A 90 90 0 {{ angle.large }} 1 {{ angle.x2 }} {{ angle.y2 }} Z" 
                                      fill="{% cycle '#4F46E5' '#06B6D4' '#10B981' '#F59E0B' '#EF4444' '#8B5CF6' '#EC4899' %}" 
                                      stroke="white" 
                                      stroke-width="2"/>
                                {% endwith %}
                                {% endfor %}
                            </svg>
                        </div>
                        <div class="flex flex-col justify-center space-y-2">
                            {% for label in exhibit.data.labels %}
                            {% with value=exhibit.data.values|get_item:forloop.counter0 %}
                            <div class="flex items-center">
                                <div class="w-4 h-4 mr-2" style="background-color: {% cycle '#4F46E5' '#06B6D4' '#10B981' '#F59E0B' '#EF4444' '#8B5CF6' '#EC4899' %}"></div>
                                <span class="text-sm text-gray-700">{{ label }}: <strong>{{ value }}{{ exhibit.data.unit }}</strong></span>
                            </div>
                            {% endwith %}
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
                {% endif %}
                
                <hr class="my-8">
                <h2 class="text-xl font-semibold text-gray-900 mb-4">Start Interview with This Case</h2>
                <form method="post" action="{% url 'interview_start' %}" class="bg-indigo-50 border border-indigo-200 rounded-lg p-6 mb-4">
                    {% csrf_token %}
                    <input type="hidden" name="case_id" value="{{ case.id }}">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Interview Mode</label>
                        <div class="space-y-2">
                            <label class="inline-flex items-center">
                                <input type="radio" name="mode" value="interviewer_led" required class="h-4 w-4 text-indigo-600 border-gray-300">
                                <span class="ml-2 text-gray-700">Interviewer-Led</span>
                            </label>
                            <label class="inline-flex items-center">
                                <input type="radio" name="mode" value="candidate_led" class="h-4 w-4 text-indigo-600 border-gray-300">
                                <span class="ml-2 text-gray-700">Candidate-Led</span>
                            </label>
                            <label class="inline-flex items-center">
                                <input type="radio" name="mode" value="product_management" class="h-4 w-4 text-indigo-600 border-gray-300">
                                <span class="ml-2 text-gray-700">PM Product Case</span>
                            </label>
                        </div>
                    </div>
                    <button type="submit" class="inline-flex items-center px-4 py-2 bg-indigo-600 border border-transparent rounded-md font-semibold text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition">Start Interview</button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

